const المجاملات = [
    "أنت رائع كما أنت!",
    "لديك حس فكاهة رائع!",
    "أنت مفكر ولطيف بشكل لا يصدق.",
    "أنت أقوى مما تعرف.",
    "أنت تنير الغرفة!",
    "أنت صديق حقيقي.",
    "أنت تلهمني!",
    "إبداعك لا يعرف حدوداً!",
    "لديك قلب من ذهب.",
    "أنت تحدث فرقاً في العالم.",
    "إيجابيتك معدية!",
    "لديك أخلاق عمل مذهلة.",
    "أنت تستخرج الأفضل من الناس.",
    "ابتسامتك تشرق يوم الجميع.",
    "أنت موهوب في كل ما تفعله.",
    "لطفك يجعل العالم مكاناً أفضل.",
    "لديك منظور فريد ورائع.",
    "حماسك ملهم حقاً!",
    "أنت قادر على تحقيق أشياء عظيمة.",
    "أنت تعرف دائماً كيف تجعل شخصاً ما يشعر بأنه مميز.",
    "ثقتك جديرة بالإعجاب.",
    "لديك روح جميلة.",
    "كرمك لا يعرف حدوداً.",
    "لديك عين رائعة للتفاصيل.",
    "شغفك محفز حقاً!",
    "أنت مستمع مذهل.",
    "أنت أقوى مما تعتقد!",
    "ضحكتك معدية.",
    "لديك موهبة طبيعية في جعل الآخرين يشعرون بالتقدير.",
    "أنت تجعل العالم مكاناً أفضل فقط بوجودك فيه."
];

async function أمر_مجاملة(سوك, معرف_الدردشة, رسالة) {
    try {
        if (!رسالة || !معرف_الدردشة) {
            console.log( رسالة أو معرف الدردشة غير صالح: , { رسالة, معرف_الدردشة });
            return;
        }

        let مستخدم_للمجاملة;
        
        // التحقق من المستخدمين المذكورين
        if (رسالة.message?.extendedTextMessage?.contextInfo?.mentionedJid?.length > 0) {
            مستخدم_للمجاملة = رسالة.message.extendedTextMessage.contextInfo.mentionedJid[0];
        }
        // التحقق من الرسالة التي تم الرد عليها
        else if (رسالة.message?.extendedTextMessage?.contextInfo?.participant) {
            مستخدم_للمجاملة = رسالة.message.extendedTextMessage.contextInfo.participant;
        }
        
        if (!مستخدم_للمجاملة) {
            await سوك.sendMessage(معرف_الدردشة, { 
                text:  يرجى ذكر شخص ما أو الرد على رسالته لمجاملته! 
            });
            return;
        }

        const مجاملة = المجاملات[Math.floor(Math.random() * المجاملات.length)];

        // إضافة تأخير لتجنب الحد الأقصى للمعدل
        await new Promise(حل => setTimeout(حل, 1000));

        await سوك.sendMessage(معرف_الدردشة, { 
            text: `مرحباً @${مستخدم_للمجاملة.split( @ )[0]}, ${مجاملة}`,
            mentions: [مستخدم_للمجاملة]
        });
    } catch (خطأ) {
        console.error( خطأ في أمر المجاملة: , خطأ);
        if (خطأ.data === 429) {
            await new Promise(حل => setTimeout(حل, 2000));
            try {
                await سوك.sendMessage(معرف_الدردشة, { 
                    text:  يرجى المحاولة مرة أخرى بعد بضع ثوانٍ. 
                });
            } catch (خطأ_إعادة_المحاولة) {
                console.error( خطأ في إرسال رسالة إعادة المحاولة: , خطأ_إعادة_المحاولة);
            }
        } else {
            try {
                await سوك.sendMessage(معرف_الدردشة, { 
                    text:  حدث خطأ أثناء إرسال المجاملة. 
                });
            } catch (خطأ_الإرسال) {
                console.error( خطأ في إرسال رسالة الخطأ: , خطأ_الإرسال);
            }
        }
    }
}

module.exports = { أمر_مجاملة };